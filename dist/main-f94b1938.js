class z{constructor(){this.subscribable=new de(this),this.subscribers=new Set}subscribe(e){return this.subscribers.add(e),()=>this.unsubscribe(e)}unsubscribe(e){this.subscribers.delete(e)}clear(){this.subscribers.clear()}notifySubscribers(e){return[...this.subscribers].map(t=>t(e))}}class de{constructor(e){this.dispatcher=e}subscribe(e){return this.dispatcher.subscribe(e)}unsubscribe(e){this.dispatcher.unsubscribe(e)}}class xe extends z{async dispatch(e){await Promise.all(this.notifySubscribers(e))}}class Se extends z{dispatch(e){this.notifySubscribers(e)}}class ke extends z{constructor(){super(...arguments),this.value=!1}raise(){this.value||(this.value=!0,this.notifySubscribers())}reset(){this.value=!1}isRaised(){return this.value}subscribe(e){const t=super.subscribe(e);return this.value&&e(),t}}class T extends z{get current(){return this.value}set current(e){this.value=e,this.notifySubscribers(e)}constructor(e){super(),this.value=e,this.subscribable=new Me(this)}subscribe(e,t=!0){const i=super.subscribe(e);return t&&e(this.value),i}}class Me extends de{get current(){return this.dispatcher.current}subscribe(e,t=!0){return this.dispatcher.subscribe(e,t)}}const q=[];function Te(){const s=q.at(-1);if(!s)throw new Error("The scene is not available in the current context.");return s}function bt(s){q.push(s)}function mt(s){if(q.pop()!==s)throw new Error("startScene/endScene were called out of order.")}function F(){var s;return((s=q.at(-1))==null?void 0:s.logger)??console}class ve extends Error{constructor(e,t){super(e),this.remarks=t}}const Y=[];function Z(){const s=Y.at(-1);if(!s)throw new ve("The thread is not available in the current context.",`<p><code>useThread()</code> can only be called from within generator functions.
      It&#39;s not available during rendering.</p>
`);return s}function wt(s){Y.push(s)}function xt(s){if(Y.pop()!==s)throw new Error("startThread/endThread was called out of order.")}function Pe(s){return{message:s.message,stack:s.stack,remarks:s.remarks}}function E(s,e=document.createElement("canvas")){const t=e.getContext("2d",s);if(!t)throw new Error("Could not create a 2D context.");return t}const Ee=180/Math.PI,D=Math.PI/180;class Ie{constructor(){this.resolveCurrent=null,this.current=null}async acquire(){for(;this.current;)await this.current;this.current=new Promise(e=>{this.resolveCurrent=e})}release(){var e;this.current=null,(e=this.resolveCurrent)==null||e.call(this),this.resolveCurrent=null}}const X=[];function Re(){const s=X.at(-1);if(!s)throw new Error("The playback is not available in the current context.");return s}function St(s){X.push(s)}function kt(s){if(X.pop()!==s)throw new Error("startPlayback/endPlayback were called out of order.")}function H(s,...e){const t={[s.name]:s},i=Object.getOwnPropertyDescriptor(t,s.name);if(i)for(let r=e.length-1;r>=0;r--)e[r](t,s.name,i)}function G(s){return function(e,t,i){i.value.prototype.name=s??t,i.value.prototype.threadable=!0}}function V(s,e){const t=Object.getPrototypeOf(s);t.threadable||(t.threadable=!0,t.name=typeof e=="string"?e:Ce(e))}function Ce(s){return Object.getPrototypeOf(s).name??null}var R;(function(s){s[s.Playing=0]="Playing",s[s.Rendering=1]="Rendering",s[s.Paused=2]="Paused",s[s.Presenting=3]="Presenting"})(R||(R={}));class Le{constructor(){this.frame=0,this.speed=1,this.fps=30,this.duration=0,this.finished=!1,this.slides=[],this.previousScene=null,this.state=R.Paused,this.currentSceneReference=null,this.scenes=new T([])}get onSceneChanged(){if(this.currentSceneReference===null)throw new Error("PlaybackManager has not been properly initialized");return this.currentSceneReference.subscribable}get onScenesRecalculated(){return this.scenes.subscribable}get currentScene(){if(this.currentSceneReference===null)throw new Error("PlaybackManager has not been properly initialized");return this.currentSceneReference.current}set currentScene(e){if(!e)throw new Error("Invalid scene.");this.currentSceneReference??(this.currentSceneReference=new T(e)),this.currentSceneReference.current=e}setup(e){this.scenes.current=e,this.currentScene=e[0]}async progress(){return this.finished=await this.next(),this.finished}async seek(e){if(e<=this.frame||this.currentScene.isCached()&&this.currentScene.lastFrame<e){const t=this.findBestScene(e);t!==this.currentScene?(this.previousScene=null,this.currentScene=t,this.frame=this.currentScene.firstFrame,await this.currentScene.reset()):this.frame>=e&&(this.previousScene=null,this.frame=this.currentScene.firstFrame,await this.currentScene.reset())}for(this.finished=!1;this.frame<e&&!this.finished;)this.finished=await this.next();return this.finished}async goBack(){let e=this.currentScene.slides.getCurrent();if(e&&this.currentScene.slides.isWaiting()){const t=this.slides.indexOf(e);e=this.slides[t-1]}await this.seekSlide(e)}async goForward(){const e=this.currentScene.slides.getCurrent(),t=this.slides.indexOf(e);await this.seekSlide(this.slides[t+1])}async goTo(e){await this.seekSlide(this.slides.find(t=>t.id===e))}async seekSlide(e=null){if(!e)return;const{id:t,scene:i}=e;for((this.currentScene!==i||this.currentScene.slides.didHappen(t))&&(this.previousScene=null,this.currentScene=i,this.frame=this.currentScene.firstFrame,this.currentScene.slides.setTarget(t),await this.currentScene.reset()),this.finished=!1,this.currentScene.slides.setTarget(t);!this.currentScene.slides.isWaitingFor(t)&&!this.finished;)this.finished=await this.next();return this.currentScene.slides.setTarget(null),this.finished}async reset(){this.previousScene=null,this.currentScene=this.scenes.current[0],this.frame=0,await this.currentScene.reset()}reload(e){this.scenes.current.forEach(t=>t.reload(e))}async recalculate(){this.previousScene=null,this.slides=[];const e=this.speed;this.frame=0,this.speed=1;const t=[];try{for(const i of this.scenes.current)await i.recalculate(r=>{this.frame=r}),this.slides.push(...i.slides.onChanged.current),t.push(i)}finally{this.speed=e}this.scenes.current=t,this.duration=this.frame}async next(){if(this.previousScene&&(await this.previousScene.next(),this.currentScene.isFinished()&&(this.previousScene=null)),this.frame+=this.speed,this.currentScene.isFinished())return!0;if(await this.currentScene.next(),this.previousScene&&this.currentScene.isAfterTransitionIn()&&(this.previousScene=null),this.currentScene.canTransitionOut()){this.previousScene=this.currentScene;const e=this.getNextScene(this.previousScene);e&&(this.currentScene=e,await this.currentScene.reset(this.previousScene)),(!e||this.currentScene.isAfterTransitionIn())&&(this.previousScene=null)}return this.currentScene.isFinished()}findBestScene(e){let t=this.scenes.current[0];for(const i of this.scenes.current){if(!i.isCached()||i.lastFrame>e)return i;t=i}return t}getNextScene(e){const t=this.scenes.current;if(!e)return t[0];const i=t.findIndex(r=>r===e);return i<0?null:t[i+1]??null}}function Ae(s){const e=Te(),t=Z();return e.timeEvents.register(s,t.time())}function Ne(s,e,t){if(e.length>=s.length){const i=Math.floor(e.length*t),r=Math.floor(w(s.length-1,e.length,t));let a="";for(let n=0;n<e.length;n++)n<i?a+=e[n]:(s[n]||n<=r)&&(a+=s[n]??e[n]);return a}else{const i=Math.round(s.length*(1-t)),r=Math.floor(w(s.length+1,e.length,t)),a=[];for(let n=s.length-1;n>=0;n--)n<i?a.unshift(s[n]):(e[n]||n<r)&&a.unshift(e[n]??s[n]);return a.join("")}}function _(s,e,t,i=!1){if(t===0)return s;if(t===1)return e;if(s==null||e==null){i||F().warn(`Attempting to lerp ${s} -> ${e} may result in unexpected behavior.`);return}if(typeof s=="number"&&typeof e=="number")return w(s,e,t);if(typeof s=="string"&&typeof e=="string")return Ne(s,e,t);if(typeof s=="boolean"&&typeof e=="boolean")return t<.5?s:e;if("lerp"in s)return s.lerp(e,t);if(s&&e&&typeof s=="object"&&typeof e=="object")if(Array.isArray(s)&&Array.isArray(e)){if(s.length===e.length)return s.map((r,a)=>_(r,e[a],t))}else{let r=!1;if(!(s instanceof Map)&&!(e instanceof Map)&&(r=!0,s=new Map(Object.entries(s)),e=new Map(Object.entries(e))),s instanceof Map&&e instanceof Map){const a=new Map;for(const n of new Set([...s.keys(),...e.keys()])){const h=_(s.get(n),e.get(n),t,!0);h!==void 0&&a.set(n,h)}return r?Object.fromEntries(a):a}}return e}function w(s,e,t){return s+(e-s)*t}function Mt(s,e,t,i,r){return t+(r-s)*(i-t)/(e-s)}function W(s,e,t){return t<s?s:t>e?e:t}function ze(s,e,t){let i=e;t>1?t=1/t:i=!i;const r=i?Math.acos(W(-1,1,1-s)):Math.asin(s),a=w(r,w(0,Math.PI/2,s),t);let n=Math.sin(a),h=1-Math.cos(a);return e&&([n,h]=[h,n]),new l(n,h)}function qe(s,e=0,t=1){return s=s<.5?4*s*s*s:1-Math.pow(-2*s+2,3)/2,w(e,t,s)}function Tt(s,e=0,t=1){return s=s===1?1:1-Math.pow(2,-10*s),w(e,t,s)}function Pt(s,e=0,t=1){return w(e,t,s)}H(fe,G());function*fe(s,e,t){const i=Z(),r=i.time(),a=i.time()+s;for(e(0,0);a>i.fixed;){const n=i.fixed-r,h=n/s;n>0&&e(h,n),yield}i.time(a),e(1,s),t==null||t(1,s)}H(Oe,G());function*Oe(s,e){yield*$(Ae(s)),e&&(yield*e)}H($,G());function*$(s=0,e){const t=Z(),i=Re().framesToSeconds(1),r=t.time()+s;for(;r-i>t.fixed;)yield;t.time(r),e&&(yield*e)}function ee(s,e){let t;return typeof s=="string"?(t=e(),V(t,s)):(t=s(),V(t,t)),t}class b{static collectPromise(e,t=null){const i={promise:e,value:t,stack:new Error().stack},r=this.collectionStack.at(-1);return r&&(i.owner=r.owner),e.then(a=>{i.value=a,r==null||r.markDirty()}),this.promises.push(i),i}static hasPromises(){return this.promises.length>0}static async consumePromises(){const e=[...this.promises];return await Promise.all(e.map(t=>t.promise)),this.promises=this.promises.filter(t=>!e.includes(t)),e}constructor(e){this.owner=e,this.dependencies=new Set,this.event=new ke,this.markDirty=()=>this.event.raise(),this.invokable=this.invoke.bind(this),Object.defineProperty(this.invokable,"context",{value:this}),Object.defineProperty(this.invokable,"toPromise",{value:this.toPromise.bind(this)})}invoke(){}startCollecting(){if(b.collectionSet.has(this))throw new ve("A circular dependency occurred between signals.",`This can happen when signals reference each other in a loop.
        Try using the attached stack trace to locate said loop.`);b.collectionSet.add(this),b.collectionStack.push(this)}finishCollecting(){if(b.collectionSet.delete(this),b.collectionStack.pop()!==this)throw new Error("collectStart/collectEnd was called out of order.")}clearDependencies(){this.dependencies.forEach(e=>e.unsubscribe(this.markDirty)),this.dependencies.clear()}collect(){const e=b.collectionStack.at(-1);e&&(e.dependencies.add(this.event.subscribable),this.event.subscribe(e.markDirty))}dispose(){this.clearDependencies(),this.event.clear(),this.owner=null}async toPromise(){do await b.consumePromises(),this.invokable();while(b.hasPromises());return this.invokable}}b.collectionSet=new Set;b.collectionStack=[];b.promises=[];function C(s){return typeof s=="function"}function De(s,e){return C(s)?()=>e(s()):e(s)}function je(s){return C(s)?s():s}const te=Symbol.for("@motion-canvas/core/signals/default");class se extends b{constructor(e,t,i=void 0,r=n=>n,a={}){super(i),this.initial=e,this.interpolation=t,this.parser=r,Object.defineProperty(this.invokable,"reset",{value:this.reset.bind(this)}),Object.defineProperty(this.invokable,"save",{value:this.save.bind(this)}),Object.defineProperty(this.invokable,"isInitial",{value:this.isInitial.bind(this)}),this.initial!==void 0&&(this.current=this.initial,this.markDirty(),C(this.initial)||(this.last=this.parse(this.initial))),this.extensions={getter:this.getter.bind(this),setter:this.setter.bind(this),tweener:this.tweener.bind(this),...a}}toSignal(){return this.invokable}parse(e){return this.parser(e)}set(e){return this.extensions.setter(e),this.owner}setter(e){return e===te&&(e=this.initial),this.current===e?this.owner:(this.current=e,this.markDirty(),this.clearDependencies(),C(e)||(this.last=this.parse(e)),this.owner)}get(){return this.extensions.getter()}getter(){var e;if(this.event.isRaised()&&C(this.current)){this.clearDependencies(),this.startCollecting();try{this.last=this.parse(this.current())}catch(t){F().error({...Pe(t),inspect:(e=this.owner)==null?void 0:e.key})}this.finishCollecting()}return this.event.reset(),this.collect(),this.last}invoke(e,t,i=qe,r=this.interpolation){return e===void 0?this.get():t===void 0?this.set(e):this.createQueue(i,r).to(e,t)}createQueue(e,t){const i=this.get(),r=[],a=ee("animation chain",function*(){for(;r.length>0;)yield*r.shift()});return a.to=(n,h,c=e,o=t)=>(e=c,t=o,r.push(this.tween(n,h,c,o)),a),a.back=(n,h=e,c=t)=>(e=h,t=c,r.push(this.tween(i,n,e,t)),a),a.wait=n=>(r.push($(n)),a),a.run=n=>(r.push(n),a),a.do=n=>(r.push(ee(function*(){n()})),a),a}*tween(e,t,i,r){e===te&&(e=this.initial),yield*this.extensions.tweener(e,t,i,r),this.set(e)}*tweener(e,t,i,r){const a=this.get();yield*fe(t,n=>{this.set(r(a,this.parse(je(e)),i(n)))})}dispose(){super.dispose(),this.initial=void 0,this.current=void 0,this.last=void 0}reset(){return this.initial!==void 0&&this.set(this.initial),this.owner}save(){return this.set(this.get())}isInitial(){return this.collect(),this.current===this.initial}raw(){return this.current}}class Be extends se{constructor(e,t,i,r,a=void 0,n={}){var h;super(void 0,r,a,t,n),this.entries=e,this.signals=[],this.parser=t;for(const c of e){let o,d;Array.isArray(c)?([o,d]=c,(h=d.context).owner??(h.owner=this)):(o=c,d=new se(De(i,v=>t(v)[c]),w,a??this.invokable).toSignal()),this.signals.push([o,d]),Object.defineProperty(this.invokable,o,{value:d})}}toSignal(){return this.invokable}parse(e){return this.parser(e)}getter(){return this.parse(Object.fromEntries(this.signals.map(([e,t])=>[e,t()])))}setter(e){if(C(e))for(const[t,i]of this.signals)i(()=>this.parser(e())[t]);else{const t=this.parse(e);for(const[i,r]of this.signals)r(t[i])}return this.owner}reset(){for(const[,e]of this.signals)e.reset();return this.owner}save(){for(const[,e]of this.signals)e.save();return this.owner}}var ie;(function(s){s[s.Vertical=1]="Vertical",s[s.Horizontal=2]="Horizontal"})(ie||(ie={}));var x;(function(s){s[s.Top=4]="Top",s[s.Bottom=8]="Bottom",s[s.Left=16]="Left",s[s.Right=32]="Right"})(x||(x={}));var N;(function(s){s[s.Middle=3]="Middle",s[s.Top=5]="Top",s[s.Bottom=9]="Bottom",s[s.Left=18]="Left",s[s.Right=34]="Right",s[s.TopLeft=20]="TopLeft",s[s.TopRight=36]="TopRight",s[s.BottomLeft=24]="BottomLeft",s[s.BottomRight=40]="BottomRight"})(N||(N={}));function Et(s){if(s===N.Middle)return l.zero;let e=0;s&x.Left?e=-1:s&x.Right&&(e=1);let t=0;return s&x.Top?t=-1:s&x.Bottom&&(t=1),new l(e,t)}const pe=1e-6;class f{static fromRotation(e){return f.identity.rotate(e)}static fromTranslation(e){return f.identity.translate(new l(e))}static fromScaling(e){return f.identity.scale(new l(e))}get x(){return new l(this.values[0],this.values[1])}get y(){return new l(this.values[2],this.values[3])}get scaleX(){return this.values[0]}set scaleX(e){this.values[0]=this.x.normalized.scale(e).x}get skewX(){return this.values[1]}set skewX(e){this.values[1]=e}get scaleY(){return this.values[3]}set scaleY(e){this.values[3]=this.y.normalized.scale(e).y}get skewY(){return this.values[2]}set skewY(e){this.values[2]=e}get translateX(){return this.values[4]}set translateX(e){this.values[4]=e}get translateY(){return this.values[5]}set translateY(e){this.values[5]=e}get rotation(){return l.degrees(this.values[0],this.values[1])}set rotation(e){const t=this.rotate(e-this.rotation);this.values[0]=t.values[0],this.values[1]=t.values[1],this.values[2]=t.values[2],this.values[3]=t.values[3]}get translation(){return new l(this.values[4],this.values[5])}set translation(e){const t=new l(e);this.values[4]=t.x,this.values[5]=t.y}get scaling(){return new l(this.values[0],this.values[3])}set scaling(e){const t=new l(e),i=new l(this.values[0],this.values[1]).normalized,r=new l(this.values[2],this.values[3]).normalized;this.values[0]=i.x*t.x,this.values[1]=i.y*t.y,this.values[2]=r.x*t.x,this.values[3]=r.y*t.y}get inverse(){const e=this.values[0],t=this.values[1],i=this.values[2],r=this.values[3],a=this.values[4],n=this.values[5];let h=e*r-t*i;return h?(h=1/h,new f(r*h,-t*h,-i*h,e*h,(i*n-r*a)*h,(t*a-e*n)*h)):null}get determinant(){return this.values[0]*this.values[3]-this.values[1]*this.values[2]}get domMatrix(){return new DOMMatrix([this.values[0],this.values[1],this.values[2],this.values[3],this.values[4],this.values[5]])}constructor(e,t,i,r,a,n){if(this.values=new Float32Array(6),arguments.length===0){this.values=new Float32Array([1,0,0,1,0,0]);return}if(arguments.length===6){this.values[0]=e,this.values[1]=t,this.values[2]=i,this.values[3]=r,this.values[4]=a,this.values[5]=n;return}if(e instanceof DOMMatrix){this.values[0]=e.m11,this.values[1]=e.m12,this.values[2]=e.m21,this.values[3]=e.m22,this.values[4]=e.m41,this.values[5]=e.m42;return}if(e instanceof f){this.values=e.values;return}if(Array.isArray(e)){if(e.length===2){this.values[0]=e[0],this.values[1]=e[1],this.values[2]=t[0],this.values[3]=t[1],this.values[4]=i[0],this.values[5]=i[1];return}if(e.length===3){const d=new l(e[0]),v=new l(e[1]),g=new l(e[2]);this.values[0]=d.x,this.values[1]=d.y,this.values[2]=v.x,this.values[3]=v.y,this.values[4]=g.x,this.values[5]=g.y;return}this.values[0]=e[0],this.values[1]=e[1],this.values[2]=e[2],this.values[3]=e[3],this.values[4]=e[4],this.values[5]=e[5];return}const h=new l(e),c=new l(t),o=new l(i);this.values[0]=h.x,this.values[1]=h.y,this.values[2]=c.x,this.values[3]=c.y,this.values[4]=o.x,this.values[5]=o.y}column(e){return new l(this.values[e*2],this.values[e*2+1])}row(e){return[this.values[e],this.values[e+2],this.values[e+4]]}mul(e){const t=this.values[0],i=this.values[1],r=this.values[2],a=this.values[3],n=this.values[4],h=this.values[5],c=e.values[0],o=e.values[1],d=e.values[2],v=e.values[3],g=e.values[4],k=e.values[5];return new f(t*c+r*o,i*c+a*o,t*d+r*v,i*d+a*v,t*g+r*k+n,i*g+a*k+h)}rotate(e,t=!0){t&&(e*=D);const i=this.values[0],r=this.values[1],a=this.values[2],n=this.values[3],h=this.values[4],c=this.values[5],o=Math.sin(e),d=Math.cos(e);return new f(i*d+a*o,r*d+n*o,i*-o+a*d,r*-o+n*d,h,c)}scale(e){const t=new l(e);return new f(this.values[0]*t.x,this.values[1]*t.x,this.values[2]*t.y,this.values[3]*t.y,this.values[4],this.values[5])}mulScalar(e){return new f(this.values[0]*e,this.values[1]*e,this.values[2]*e,this.values[3]*e,this.values[4]*e,this.values[5]*e)}translate(e){const t=new l(e);return new f(this.values[0],this.values[1],this.values[2],this.values[3],this.values[0]*t.x+this.values[2]*t.y+this.values[4],this.values[1]*t.x+this.values[3]*t.y+this.values[5])}add(e){return new f(this.values[0]+e.values[0],this.values[1]+e.values[1],this.values[2]+e.values[2],this.values[3]+e.values[3],this.values[4]+e.values[4],this.values[5]+e.values[5])}sub(e){return new f(this.values[0]-e.values[0],this.values[1]-e.values[1],this.values[2]-e.values[2],this.values[3]-e.values[3],this.values[4]-e.values[4],this.values[5]-e.values[5])}toSymbol(){return f.symbol}equals(e,t=pe){return Math.abs(this.values[0]-e.values[0])<=t+Number.EPSILON&&Math.abs(this.values[1]-e.values[1])<=t+Number.EPSILON&&Math.abs(this.values[2]-e.values[2])<=t+Number.EPSILON&&Math.abs(this.values[3]-e.values[3])<=t+Number.EPSILON&&Math.abs(this.values[4]-e.values[4])<=t+Number.EPSILON&&Math.abs(this.values[5]-e.values[5])<=t+Number.EPSILON}exactlyEquals(e){return this.values[0]===e.values[0]&&this.values[1]===e.values[1]&&this.values[2]===e.values[2]&&this.values[3]===e.values[3]&&this.values[4]===e.values[4]&&this.values[5]===e.values[5]}}f.symbol=Symbol.for("@motion-canvas/core/types/Matrix2D");f.identity=new f(1,0,0,1,0,0);f.zero=new f(0,0,0,0,0,0);class l{static createSignal(e,t=l.lerp,i){return new Be(["x","y"],r=>new l(r),e,t,i).toSignal()}static lerp(e,t,i){let r,a;return typeof i=="number"?r=a=i:(r=i.x,a=i.y),new l(w(e.x,t.x,r),w(e.y,t.y,a))}static arcLerp(e,t,i,r=!1,a){return a??(a=e.sub(t).ctg),l.lerp(e,t,ze(i,r,a))}static createArcLerp(e,t){return(i,r,a)=>l.arcLerp(i,r,a,e,t)}static polarLerp(e,t,i,r=!1,a=l.zero){e=e.sub(a),t=t.sub(a);const n=e.degrees;let h=t.degrees;n>h!==r&&(h=h+(r?-360:360));const o=w(n,h,i)*D,d=w(e.magnitude,t.magnitude,i);return new l(d*Math.cos(o)+a.x,d*Math.sin(o)+a.y)}static createPolarLerp(e=!1,t=l.zero){return(i,r,a)=>l.polarLerp(i,r,a,e,new l(t))}static fromOrigin(e){const t=new l;return e===N.Middle||(e&x.Left?t.x=-1:e&x.Right&&(t.x=1),e&x.Top?t.y=-1:e&x.Bottom&&(t.y=1)),t}static fromScalar(e){return new l(e,e)}static fromRadians(e){return new l(Math.cos(e),Math.sin(e))}static fromDegrees(e){return l.fromRadians(e*D)}static radians(e,t){return Math.atan2(t,e)}static degrees(e,t){return l.radians(e,t)*Ee}static magnitude(e,t){return Math.sqrt(e*e+t*t)}static squaredMagnitude(e,t){return e*e+t*t}static angleBetween(e,t){return Math.acos(W(-1,1,e.dot(t)/(e.magnitude*t.magnitude)))*(e.cross(t)>=0?1:-1)}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}get magnitude(){return l.magnitude(this.x,this.y)}get squaredMagnitude(){return l.squaredMagnitude(this.x,this.y)}get normalized(){return this.scale(1/l.magnitude(this.x,this.y))}get safe(){return new l(isNaN(this.x)?0:this.x,isNaN(this.y)?0:this.y)}get flipped(){return new l(-this.x,-this.y)}get floored(){return new l(Math.floor(this.x),Math.floor(this.y))}get perpendicular(){return new l(this.y,-this.x)}get radians(){return l.radians(this.x,this.y)}get degrees(){return l.degrees(this.x,this.y)}get ctg(){return this.x/this.y}constructor(e,t){if(this.x=0,this.y=0,e!=null){if(typeof e!="object"){this.x=e,this.y=t??e;return}if(Array.isArray(e)){this.x=e[0],this.y=e[1];return}if("width"in e){this.x=e.width,this.y=e.height;return}this.x=e.x,this.y=e.y}}lerp(e,t){return l.lerp(this,e,t)}getOriginOffset(e){const t=l.fromOrigin(e);return t.x*=this.x/2,t.y*=this.y/2,t}scale(e){return new l(this.x*e,this.y*e)}transformAsPoint(e){const t=new f(e);return new l(this.x*t.scaleX+this.y*t.skewY+t.translateX,this.x*t.skewX+this.y*t.scaleY+t.translateY)}transform(e){const t=new f(e);return new l(this.x*t.scaleX+this.y*t.skewY,this.x*t.skewX+this.y*t.scaleY)}mul(e){const t=new l(e);return new l(this.x*t.x,this.y*t.y)}div(e){const t=new l(e);return new l(this.x/t.x,this.y/t.y)}add(e){const t=new l(e);return new l(this.x+t.x,this.y+t.y)}sub(e){const t=new l(e);return new l(this.x-t.x,this.y-t.y)}dot(e){const t=new l(e);return this.x*t.x+this.y*t.y}cross(e){const t=new l(e);return this.x*t.y-this.y*t.x}mod(e){const t=new l(e);return new l(this.x%t.x,this.y%t.y)}rotate(e,t=l.zero){const i=new l(t),r=f.fromTranslation(i).rotate(e).translate(i.flipped);return this.transformAsPoint(r)}addX(e){return new l(this.x+e,this.y)}addY(e){return new l(this.x,this.y+e)}toSymbol(){return l.symbol}toString(){return`Vector2(${this.x}, ${this.y})`}serialize(){return{x:this.x,y:this.y}}exactlyEquals(e){return this.x===e.x&&this.y===e.y}equals(e,t=pe){return Math.abs(this.x-e.x)<=t+Number.EPSILON&&Math.abs(this.y-e.y)<=t+Number.EPSILON}}l.symbol=Symbol.for("@motion-canvas/core/types/Vector2");l.zero=new l;l.one=new l(1,1);l.right=new l(1,0);l.left=new l(-1,0);l.up=new l(0,1);l.down=new l(0,-1);class Fe{constructor(e){this.playback=e}secondsToFrames(e){return Math.ceil(e*this.playback.fps)}framesToSeconds(e){return e/this.playback.fps}get time(){return this.framesToSeconds(this.playback.frame)}get frame(){return this.playback.frame}get speed(){return this.playback.speed}get fps(){return this.playback.fps}get state(){return this.playback.state}}class Ye{get onDataChanged(){return this.data.subscribable}constructor(e){this.logger=e,this.data=new T(null),this.context=new AudioContext,this.audioElement=new Audio,this.source=null,this.error=!1,this.abortController=null,this.offset=0}getTime(){return this.toAbsoluteTime(this.audioElement.currentTime)}setTime(e){this.audioElement.currentTime=this.toRelativeTime(e)}setOffset(e){this.offset=e}setMuted(e){this.audioElement.muted=e}setSource(e){var t;this.source=e,this.audioElement.src=e,(t=this.abortController)==null||t.abort(),this.abortController=new AbortController,this.loadData(this.abortController.signal).catch(i=>{i.name!=="AbortError"&&this.logger.error(i)})}isInRange(e){return e>=this.offset&&e<this.audioElement.duration}toRelativeTime(e){return Math.max(0,e-this.offset)}toAbsoluteTime(e){return e+this.offset}isReady(){return this.source&&!this.error}async setPaused(e){if(this.source&&this.audioElement.paused!==e)if(e)this.audioElement.pause();else try{return await this.audioElement.play(),this.error=!1,!0}catch(t){this.error||F().error(t),this.error=!0}return!1}async loadData(e){if(this.data.current=null,!this.source)return;const i=await(await fetch(this.source,{signal:e})).arrayBuffer();if(e.aborted)return;let r;try{r=await this.decodeAudioData(i)}catch{return}if(e.aborted)return;const a=256,n=~~(r.length/a),h=[];let c=0;for(let o=0;o<r.numberOfChannels;o++){const d=r.getChannelData(o);for(let v=0;v<n;v++){const g=~~(v*a),k=~~(g+a);let M=d[g],P=M;for(let O=g;O<k;O++){const A=d[O];A>P&&(P=A),A<M&&(M=A)}(o===0||P>h[v*2])&&(h[v*2]=P),(o===0||M<h[v*2+1])&&(h[v*2+1]=M),P>c&&(c=P),Math.abs(M)>c&&(c=Math.abs(M))}}this.data.current={peaks:h,absoluteMax:c,length:n,sampleRate:r.sampleRate/a*2}}decodeAudioData(e){return new Promise((t,i)=>this.context.decodeAudioData(e,t,i).catch(i))}}class Ze{get onChanged(){return this.events.subscribable}constructor(e){this.scene=e,this.events=new T([]),this.registeredEvents=new Map,this.lookup=new Map,this.collisionLookup=new Set,this.previousReference=[],this.didEventsChange=!1,this.preserveTiming=!0,this.handleReload=()=>{this.registeredEvents.clear(),this.collisionLookup.clear()},this.handleRecalculated=()=>{var t;this.preserveTiming=!0,this.events.current=[...this.registeredEvents.values()],(this.didEventsChange||(((t=this.previousReference)==null?void 0:t.length)??0)!==this.events.current.length)&&(this.didEventsChange=!1,this.previousReference=[...this.registeredEvents.values()].map(i=>({name:i.name,targetTime:i.targetTime})),this.scene.meta.timeEvents.set(this.previousReference))},this.handleReset=()=>{this.collisionLookup.clear()},this.handleMetaChanged=t=>{t!==this.previousReference&&(this.previousReference=t,this.load(t),this.scene.reload())},this.previousReference=e.meta.timeEvents.get(),this.load(this.previousReference),e.onReloaded.subscribe(this.handleReload),e.onRecalculated.subscribe(this.handleRecalculated),e.onReset.subscribe(this.handleReset),e.meta.timeEvents.onChanged.subscribe(this.handleMetaChanged,!1)}set(e,t,i=!0){let r=this.lookup.get(e);!r||r.offset===t||(this.preserveTiming=i,r={...r,targetTime:r.initialTime+t,offset:t},this.lookup.set(e,r),this.registeredEvents.set(e,r),this.events.current=[...this.registeredEvents.values()],this.didEventsChange=!0,this.scene.reload())}register(e,t){if(this.collisionLookup.has(e))return this.scene.logger.error({message:`name "${e}" has already been used for another event name.`,stack:new Error().stack}),0;this.collisionLookup.add(e);let i=this.lookup.get(e);if(!i)this.didEventsChange=!0,i={name:e,initialTime:t,targetTime:t,offset:0,stack:new Error().stack},this.lookup.set(e,i);else{let r=!1;const a={...i},n=new Error().stack;a.stack!==n&&(a.stack=n,r=!0),a.initialTime!==t&&(a.initialTime=t,r=!0);const h=Math.max(0,a.targetTime-a.initialTime);this.preserveTiming&&a.offset!==h&&(a.offset=h,r=!0);const c=a.initialTime+a.offset;!this.preserveTiming&&a.targetTime!==c&&(this.didEventsChange=!0,a.targetTime=c,r=!0),r&&(i=a,this.lookup.set(e,i))}return this.registeredEvents.set(e,i),i.offset}load(e){for(const t of e){const i=this.lookup.get(t.name)??{name:t.name,initialTime:0,offset:0};this.lookup.set(t.name,{...i,targetTime:t.targetTime})}}}const re=1/50;class Xe{get onRender(){return this.render.subscribable}get onStateChanged(){return this.playerState.subscribable}get onFrameChanged(){return this.frame.subscribable}get onDurationChanged(){return this.duration.subscribable}get onRecalculated(){return this.recalculated.subscribable}get startFrame(){return Math.min(this.playback.duration,this.status.secondsToFrames(this.startTime))}get endFrame(){return Math.min(this.playback.duration,this.status.secondsToFrames(this.endTime))}get finished(){return this.playback.finished||this.playback.frame>=this.endFrame}constructor(e,t={},i={},r=-1){var n,h,c;this.project=e,this.settings=t,this.initialState=i,this.initialFrame=r,this.render=new xe,this.frame=new T(0),this.duration=new T(0),this.recalculated=new Se,this.lock=new Ie,this.startTime=0,this.endTime=1/0,this.requestId=null,this.renderTime=0,this.requestedSeek=-1,this.requestedRecalculation=!0,this.active=!1,this.playerState=new T({loop:!0,muted:!0,speed:1,...i,paused:!0}),this.requestedSeek=r,this.logger=this.project.logger,this.playback=new Le,this.status=new Fe(this.playback),this.audio=new Ye(this.logger),this.size=t.size??new l(1920,1080),this.resolutionScale=t.resolutionScale??1,this.startTime=((n=t.range)==null?void 0:n[0])??0,this.endTime=((h=t.range)==null?void 0:h[1])??1/0,this.playback.fps=t.fps??60,this.audio.setOffset(t.audioOffset??0),e.audio&&this.audio.setSource(e.audio);const a=[];for(const o of e.scenes){const d=new o.klass({...o,playback:this.status,logger:this.project.logger,size:this.size,resolutionScale:this.resolutionScale,timeEventsClass:Ze});(c=o.onReplaced)==null||c.subscribe(v=>{d.reload(v)},!1),d.onReloaded.subscribe(()=>this.requestRecalculation()),d.variables.updateSignals(e.variables??{}),a.push(d)}this.playback.setup(a),this.activate()}async configure(e){await this.lock.acquire();let t=this.playback.frame,i=!1;if(this.startTime=e.range[0],this.endTime=e.range[1],this.playback.fps!==e.fps){const r=e.fps/this.playback.fps;this.playback.fps=e.fps,t=Math.floor(t*r),i=!0}(!e.size.exactlyEquals(this.size)||e.resolutionScale!==this.resolutionScale)&&(this.size=e.size,this.resolutionScale=e.resolutionScale,this.playback.reload({size:this.size,resolutionScale:this.resolutionScale})),e.audioOffset!==void 0&&this.audio.setOffset(e.audioOffset),this.lock.release(),i&&(this.playback.reload(),this.frame.current=t,this.requestRecalculation(),this.requestedSeek=t)}requestSeek(e){this.requestedSeek=this.clampRange(e)}requestPreviousFrame(){this.requestedSeek=this.frame.current-this.playback.speed}requestNextFrame(){this.requestedSeek=this.frame.current+this.playback.speed}requestReset(){this.requestedSeek=0}toggleLoop(e=!this.playerState.current.loop){e!==this.playerState.current.loop&&(this.playerState.current={...this.playerState.current,loop:e})}togglePlayback(e=this.playerState.current.paused){e===this.playerState.current.paused&&(this.playerState.current={...this.playerState.current,paused:!e},e&&!this.playerState.current.loop&&this.playback.frame===this.playback.duration&&this.requestReset())}toggleAudio(e=this.playerState.current.muted){e===this.playerState.current.muted&&(this.playerState.current={...this.playerState.current,muted:!e})}setSpeed(e){e!==this.playerState.current.speed&&(this.playback.speed=e,this.playback.reload(),this.playerState.current={...this.playerState.current,speed:e},this.requestRecalculation())}setVariables(e){for(const t of this.playback.onScenesRecalculated.current)t.variables.updateSignals(e)}activate(){this.active=!0,this.request()}deactivate(){this.active=!1,this.requestId!==null&&(cancelAnimationFrame(this.requestId),this.requestId=null)}requestRecalculation(){this.requestedRecalculation=!0,this.request()}async prepare(){const e={...this.playerState.current,seek:this.requestedSeek};if(this.requestedSeek=-1,this.requestedRecalculation){e.seek<0&&(e.seek=this.playback.frame);try{await this.playback.recalculate(),this.duration.current=this.playback.frame,this.recalculated.dispatch()}catch(i){throw this.requestSeek(e.seek),i}finally{this.requestedRecalculation=!1}}(!e.loop&&this.finished&&!e.paused&&e.seek<0||this.endFrame===this.startFrame)&&(this.togglePlayback(!1),e.paused=!0),e.loop&&(e.seek>this.endFrame||this.finished&&!e.paused)&&this.startFrame!==this.endTime&&(e.seek=this.startFrame);const t=e.paused||this.finished||!this.audio.isInRange(this.status.time);return await this.audio.setPaused(t)&&this.syncAudio(-3),this.audio.setMuted(e.muted),e}async run(){const e=await this.prepare(),t=this.playback.state;if(this.playback.state=e.paused?R.Paused:R.Playing,e.seek>=0||!this.isInRange(this.status.frame)){const i=e.seek<0?this.status.frame:e.seek,r=this.clampRange(i);this.logger.profile("seek time"),await this.playback.seek(r),this.logger.profile("seek time"),this.syncAudio(-3)}else if(e.paused||e.speed===1&&this.audio.isReady()&&this.audio.isInRange(this.status.time)&&this.audio.getTime()<this.status.time){e.paused&&t!==R.Paused&&await this.render.dispatch(),!e.paused&&this.status.time>this.audio.getTime()+re&&this.syncAudio(),this.request();return}else if(this.audio.isReady()&&e.speed===1&&this.audio.isInRange(this.status.time)&&this.status.framesToSeconds(this.playback.frame+1)<this.audio.getTime()-re){const i=this.status.secondsToFrames(this.audio.getTime());await this.playback.seek(i)}else this.status.frame<this.endFrame&&(await this.playback.progress(),e.speed!==1&&this.syncAudio());!e.paused&&this.playback.currentScene.slides.isWaiting()&&(this.togglePlayback(!1),e.paused=!0),await this.render.dispatch(),this.frame.current=this.playback.frame,this.request()}request(){this.active&&(this.requestId??(this.requestId=requestAnimationFrame(async e=>{if(this.requestId=null,e-this.renderTime>=1e3/(this.status.fps+5)){this.renderTime=e,await this.lock.acquire();try{await this.run()}catch(t){this.logger.error(t)}this.lock.release()}else this.request()})))}clampRange(e){return W(this.startFrame,this.endFrame,e)}isInRange(e){return e>=this.startFrame&&e<=this.endFrame}syncAudio(e=0){this.audio.setTime(this.status.framesToSeconds(this.playback.frame+e))}}class He{get canvasSize(){return this.size.scale(this.resolutionScale)}constructor(){this.background=null,this.resolutionScale=1,this.colorSpace="srgb",this.size=l.zero,this.finalBuffer=document.createElement("canvas"),this.currentBuffer=document.createElement("canvas"),this.previousBuffer=document.createElement("canvas");const e=this.colorSpace;this.context=E({colorSpace:e},this.finalBuffer),this.currentContext=E({colorSpace:e},this.currentBuffer),this.previousContext=E({colorSpace:e},this.previousBuffer)}configure({colorSpace:e=this.colorSpace,size:t=this.size,resolutionScale:i=this.resolutionScale,background:r=this.background}){e!==this.colorSpace&&(this.colorSpace=e,this.context=E({colorSpace:e},this.finalBuffer),this.currentContext=E({colorSpace:e},this.currentBuffer),this.previousContext=E({colorSpace:e},this.previousBuffer)),(!t.exactlyEquals(this.size)||i!==this.resolutionScale)&&(this.resolutionScale=i,this.size=t,this.resizeCanvas(this.context),this.resizeCanvas(this.currentContext),this.resizeCanvas(this.previousContext)),this.background=typeof r=="string"?r:(r==null?void 0:r.serialize())??null}async render(e,t){t&&(this.transformCanvas(this.previousContext),await t.render(this.previousContext)),this.transformCanvas(this.currentContext),await e.render(this.currentContext);const i=this.canvasSize;this.context.clearRect(0,0,i.width,i.height),this.background&&(this.context.save(),this.context.fillStyle=this.background,this.context.fillRect(0,0,i.width,i.height),this.context.restore()),t&&this.context.drawImage(this.previousBuffer,0,0),this.context.drawImage(this.currentBuffer,0,0)}transformCanvas(e){const t=this.canvasSize.scale(.5);e.setTransform(this.resolutionScale,0,0,this.resolutionScale,t.x,t.y)}resizeCanvas(e){const t=this.canvasSize;e.canvas.width=t.width,e.canvas.height=t.height}}const Ge="modulepreload",We=function(s){return"/"+s},ae={},$e=function(e,t,i){if(!t||t.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(t.map(a=>{if(a=We(a),a in ae)return;ae[a]=!0;const n=a.endsWith(".css"),h=n?'[rel="stylesheet"]':"";if(!!i)for(let d=r.length-1;d>=0;d--){const v=r[d];if(v.href===a&&(!n||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${h}`))return;const o=document.createElement("link");if(o.rel=n?"stylesheet":Ge,n||(o.as="script",o.crossOrigin=""),o.href=a,document.head.appendChild(o),n)return new Promise((d,v)=>{o.addEventListener("load",d),o.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e()).catch(a=>{const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=a,window.dispatchEvent(n),!n.defaultPrevented)throw a})};var Je=Object.defineProperty,Qe=(s,e,t)=>e in s?Je(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,y=(s,e,t)=>(Qe(s,typeof e!="symbol"?e+"":e,t),t);const Ue=`.initial{display:none}.state-initial .initial{display:block}.loading{display:none}.state-loading .loading{display:block}.ready{display:none}.state-ready .ready{display:block}.error{display:none}.state-error .error{display:block}:host{position:relative;display:block}.overlay{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;opacity:0;background-color:#0000008a;transition:opacity .1s}.overlay.state-ready:not(.auto){cursor:pointer}.overlay.playing:not(.hover):hover{cursor:none}.overlay.hover,.overlay.state-ready:focus-within,.overlay.state-ready:not(.playing){opacity:1}.overlay.hover .button,.overlay.state-ready:focus-within .button,.overlay.state-ready:not(.playing) .button{scale:1;transition:scale .1s ease-out}.overlay.state-loading,.overlay.state-error{opacity:1;transition:opacity 1s}.overlay.state-ready.auto{opacity:0}.button{width:50%;max-width:96px;aspect-ratio:1;scale:.5;transition:scale .1s ease-in,opacity .1s;background-color:transparent;border:none;background-size:100% 100%;background-repeat:no-repeat;opacity:.54;cursor:inherit;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iI2ZmZmZmZiI+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bS0yIDE0LjV2LTlsNiA0LjUtNiA0LjV6Ii8+PC9zdmc+)}.playing .button{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIGZpbGw9IiNmZmZmZmYiPjxnPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjwvZz48Zz48Zy8+PHBhdGggZD0iTTEyLDJDNi40OCwyLDIsNi40OCwyLDEyczQuNDgsMTAsMTAsMTBzMTAtNC40OCwxMC0xMFMxNy41MiwyLDEyLDJ6IE0xMSwxNkg5VjhoMlYxNnogTTE1LDE2aC0yVjhoMlYxNnoiLz48L2c+PC9zdmc+)}.button:focus,.overlay:hover .button{opacity:.87}.auto .button{display:none}.canvas{width:100%;display:block;opacity:0;transition:opacity .1s}.canvas.state-ready{opacity:1}.message{font-family:JetBrains Mono,sans-serif;text-align:center;font-size:20px;padding:8px 16px;margin:16px;border-radius:4px;color:#fff9;background-color:#000000de}.loader{width:50%;max-width:96px;display:none;rotate:-90deg;animation:stroke 2s cubic-bezier(.5,0,.5,1) infinite,rotate 2s linear infinite}@keyframes stroke{0%{stroke-dasharray:5.6548667765px 50.8938009883px;stroke-dashoffset:2.8274333882px}50%{stroke-dasharray:50.8938009883px 5.6548667765px;stroke-dashoffset:-2.8274333882px}to{stroke-dasharray:5.6548667765px 50.8938009883px;stroke-dashoffset:-53.7212343766px}}@keyframes rotate{0%{rotate:-110deg}to{rotate:250deg}}
`,Ke=`<div class="overlay">
  <button title="Play / Pause" class="button ready" tabindex="0"></button>
  <div class="message error">
    An error occurred while loading the animation.
  </div>
  <svg
    class="loader loading"
    viewBox="0 0 24 24"
    stroke="#ffffff"
    stroke-width="2"
    fill="transparent"
  >
    <circle cx="12" cy="12" r="9" />
  </svg>
</div>
`,ye=[];function Ve(){const s=ye.at(-1);if(!s)throw new Error("The scene is not available in the current context.");return s}function _e(){var s;return((s=ye.at(-1))==null?void 0:s.logger)??console}class ge extends Error{constructor(e,t){super(e),this.remarks=t}}const et=[];function J(){const s=et.at(-1);if(!s)throw new ge("The thread is not available in the current context.",`<p><code>useThread()</code> can only be called from within generator functions.
      It&#39;s not available during rendering.</p>
`);return s}function tt(s){return{message:s.message,stack:s.stack,remarks:s.remarks}}const st=180/Math.PI,j=Math.PI/180,it=[];function rt(){const s=it.at(-1);if(!s)throw new Error("The playback is not available in the current context.");return s}function Q(s,...e){const t={[s.name]:s},i=Object.getOwnPropertyDescriptor(t,s.name);if(i)for(let r=e.length-1;r>=0;r--)e[r](t,s.name,i)}function U(s){return function(e,t,i){i.value.prototype.name=s??t,i.value.prototype.threadable=!0}}function ne(s,e){const t=Object.getPrototypeOf(s);t.threadable||(t.threadable=!0,t.name=typeof e=="string"?e:at(e))}function at(s){return Object.getPrototypeOf(s).name??null}class nt{constructor(){this.subscribable=new ht(this),this.subscribers=new Set}subscribe(e){return this.subscribers.add(e),()=>this.unsubscribe(e)}unsubscribe(e){this.subscribers.delete(e)}clear(){this.subscribers.clear()}notifySubscribers(e){return[...this.subscribers].map(t=>t(e))}}class ht{constructor(e){this.dispatcher=e}subscribe(e){return this.dispatcher.subscribe(e)}unsubscribe(e){this.dispatcher.unsubscribe(e)}}class lt extends nt{constructor(){super(...arguments),this.value=!1}raise(){this.value||(this.value=!0,this.notifySubscribers())}reset(){this.value=!1}isRaised(){return this.value}subscribe(e){const t=super.subscribe(e);return this.value&&e(),t}}function ut(s){const e=Ve(),t=J();return e.timeEvents.register(s,t.time())}function S(s,e,t){return s+(e-s)*t}function be(s,e,t){return t<s?s:t>e?e:t}function ot(s,e,t){let i=e;t>1?t=1/t:i=!i;const r=i?Math.acos(be(-1,1,1-s)):Math.asin(s),a=S(r,S(0,Math.PI/2,s),t);let n=Math.sin(a),h=1-Math.cos(a);return e&&([n,h]=[h,n]),new u(n,h)}function ct(s,e=0,t=1){return s=s<.5?4*s*s*s:1-Math.pow(-2*s+2,3)/2,S(e,t,s)}Q(me,U());function*me(s,e,t){const i=J(),r=i.time(),a=i.time()+s;for(e(0,0);a>i.fixed;){const n=i.fixed-r,h=n/s;n>0&&e(h,n),yield}i.time(a),e(1,s),t==null||t(1,s)}Q(dt,U());function*dt(s,e){yield*K(ut(s)),e&&(yield*e)}Q(K,U());function*K(s=0,e){const t=J(),i=rt().framesToSeconds(1),r=t.time()+s;for(;r-i>t.fixed;)yield;t.time(r),e&&(yield*e)}function he(s,e){let t;return typeof s=="string"?(t=e(),ne(t,s)):(t=s(),ne(t,t)),t}class m{static collectPromise(e,t=null){const i={promise:e,value:t,stack:new Error().stack},r=this.collectionStack.at(-1);return r&&(i.owner=r.owner),e.then(a=>{i.value=a,r==null||r.markDirty()}),this.promises.push(i),i}static hasPromises(){return this.promises.length>0}static async consumePromises(){const e=[...this.promises];return await Promise.all(e.map(t=>t.promise)),this.promises=this.promises.filter(t=>!e.includes(t)),e}constructor(e){this.owner=e,this.dependencies=new Set,this.event=new lt,this.markDirty=()=>this.event.raise(),this.invokable=this.invoke.bind(this),Object.defineProperty(this.invokable,"context",{value:this}),Object.defineProperty(this.invokable,"toPromise",{value:this.toPromise.bind(this)})}invoke(){}startCollecting(){if(m.collectionSet.has(this))throw new ge("A circular dependency occurred between signals.",`This can happen when signals reference each other in a loop.
        Try using the attached stack trace to locate said loop.`);m.collectionSet.add(this),m.collectionStack.push(this)}finishCollecting(){if(m.collectionSet.delete(this),m.collectionStack.pop()!==this)throw new Error("collectStart/collectEnd was called out of order.")}clearDependencies(){this.dependencies.forEach(e=>e.unsubscribe(this.markDirty)),this.dependencies.clear()}collect(){const e=m.collectionStack.at(-1);e&&(e.dependencies.add(this.event.subscribable),this.event.subscribe(e.markDirty))}dispose(){this.clearDependencies(),this.event.clear(),this.owner=null}async toPromise(){do await m.consumePromises(),this.invokable();while(m.hasPromises());return this.invokable}}m.collectionSet=new Set;m.collectionStack=[];m.promises=[];function L(s){return typeof s=="function"}function vt(s,e){return L(s)?()=>e(s()):e(s)}function ft(s){return L(s)?s():s}const le=Symbol.for("@motion-canvas/core/signals/default");class ue extends m{constructor(e,t,i=void 0,r=n=>n,a={}){super(i),this.initial=e,this.interpolation=t,this.parser=r,Object.defineProperty(this.invokable,"reset",{value:this.reset.bind(this)}),Object.defineProperty(this.invokable,"save",{value:this.save.bind(this)}),Object.defineProperty(this.invokable,"isInitial",{value:this.isInitial.bind(this)}),this.initial!==void 0&&(this.current=this.initial,this.markDirty(),L(this.initial)||(this.last=this.parse(this.initial))),this.extensions={getter:this.getter.bind(this),setter:this.setter.bind(this),tweener:this.tweener.bind(this),...a}}toSignal(){return this.invokable}parse(e){return this.parser(e)}set(e){return this.extensions.setter(e),this.owner}setter(e){return e===le&&(e=this.initial),this.current===e?this.owner:(this.current=e,this.markDirty(),this.clearDependencies(),L(e)||(this.last=this.parse(e)),this.owner)}get(){return this.extensions.getter()}getter(){var e;if(this.event.isRaised()&&L(this.current)){this.clearDependencies(),this.startCollecting();try{this.last=this.parse(this.current())}catch(t){_e().error({...tt(t),inspect:(e=this.owner)==null?void 0:e.key})}this.finishCollecting()}return this.event.reset(),this.collect(),this.last}invoke(e,t,i=ct,r=this.interpolation){return e===void 0?this.get():t===void 0?this.set(e):this.createQueue(i,r).to(e,t)}createQueue(e,t){const i=this.get(),r=[],a=he("animation chain",function*(){for(;r.length>0;)yield*r.shift()});return a.to=(n,h,c=e,o=t)=>(e=c,t=o,r.push(this.tween(n,h,c,o)),a),a.back=(n,h=e,c=t)=>(e=h,t=c,r.push(this.tween(i,n,e,t)),a),a.wait=n=>(r.push(K(n)),a),a.run=n=>(r.push(n),a),a.do=n=>(r.push(he(function*(){n()})),a),a}*tween(e,t,i,r){e===le&&(e=this.initial),yield*this.extensions.tweener(e,t,i,r),this.set(e)}*tweener(e,t,i,r){const a=this.get();yield*me(t,n=>{this.set(r(a,this.parse(ft(e)),i(n)))})}dispose(){super.dispose(),this.initial=void 0,this.current=void 0,this.last=void 0}reset(){return this.initial!==void 0&&this.set(this.initial),this.owner}save(){return this.set(this.get())}isInitial(){return this.collect(),this.current===this.initial}raw(){return this.current}}class pt extends ue{constructor(e,t,i,r,a=void 0,n={}){var h;super(void 0,r,a,t,n),this.entries=e,this.signals=[],this.parser=t;for(const c of e){let o,d;Array.isArray(c)?([o,d]=c,(h=d.context).owner??(h.owner=this)):(o=c,d=new ue(vt(i,v=>t(v)[c]),S,a??this.invokable).toSignal()),this.signals.push([o,d]),Object.defineProperty(this.invokable,o,{value:d})}}toSignal(){return this.invokable}parse(e){return this.parser(e)}getter(){return this.parse(Object.fromEntries(this.signals.map(([e,t])=>[e,t()])))}setter(e){if(L(e))for(const[t,i]of this.signals)i(()=>this.parser(e())[t]);else{const t=this.parse(e);for(const[i,r]of this.signals)r(t[i])}return this.owner}reset(){for(const[,e]of this.signals)e.reset();return this.owner}save(){for(const[,e]of this.signals)e.save();return this.owner}}var oe;(function(s){s[s.Vertical=1]="Vertical",s[s.Horizontal=2]="Horizontal"})(oe||(oe={}));var I;(function(s){s[s.Top=4]="Top",s[s.Bottom=8]="Bottom",s[s.Left=16]="Left",s[s.Right=32]="Right"})(I||(I={}));var B;(function(s){s[s.Middle=3]="Middle",s[s.Top=5]="Top",s[s.Bottom=9]="Bottom",s[s.Left=18]="Left",s[s.Right=34]="Right",s[s.TopLeft=20]="TopLeft",s[s.TopRight=36]="TopRight",s[s.BottomLeft=24]="BottomLeft",s[s.BottomRight=40]="BottomRight"})(B||(B={}));const we=1e-6;class p{static fromRotation(e){return p.identity.rotate(e)}static fromTranslation(e){return p.identity.translate(new u(e))}static fromScaling(e){return p.identity.scale(new u(e))}get x(){return new u(this.values[0],this.values[1])}get y(){return new u(this.values[2],this.values[3])}get scaleX(){return this.values[0]}set scaleX(e){this.values[0]=this.x.normalized.scale(e).x}get skewX(){return this.values[1]}set skewX(e){this.values[1]=e}get scaleY(){return this.values[3]}set scaleY(e){this.values[3]=this.y.normalized.scale(e).y}get skewY(){return this.values[2]}set skewY(e){this.values[2]=e}get translateX(){return this.values[4]}set translateX(e){this.values[4]=e}get translateY(){return this.values[5]}set translateY(e){this.values[5]=e}get rotation(){return u.degrees(this.values[0],this.values[1])}set rotation(e){const t=this.rotate(e-this.rotation);this.values[0]=t.values[0],this.values[1]=t.values[1],this.values[2]=t.values[2],this.values[3]=t.values[3]}get translation(){return new u(this.values[4],this.values[5])}set translation(e){const t=new u(e);this.values[4]=t.x,this.values[5]=t.y}get scaling(){return new u(this.values[0],this.values[3])}set scaling(e){const t=new u(e),i=new u(this.values[0],this.values[1]).normalized,r=new u(this.values[2],this.values[3]).normalized;this.values[0]=i.x*t.x,this.values[1]=i.y*t.y,this.values[2]=r.x*t.x,this.values[3]=r.y*t.y}get inverse(){const e=this.values[0],t=this.values[1],i=this.values[2],r=this.values[3],a=this.values[4],n=this.values[5];let h=e*r-t*i;return h?(h=1/h,new p(r*h,-t*h,-i*h,e*h,(i*n-r*a)*h,(t*a-e*n)*h)):null}get determinant(){return this.values[0]*this.values[3]-this.values[1]*this.values[2]}get domMatrix(){return new DOMMatrix([this.values[0],this.values[1],this.values[2],this.values[3],this.values[4],this.values[5]])}constructor(e,t,i,r,a,n){if(this.values=new Float32Array(6),arguments.length===0){this.values=new Float32Array([1,0,0,1,0,0]);return}if(arguments.length===6){this.values[0]=e,this.values[1]=t,this.values[2]=i,this.values[3]=r,this.values[4]=a,this.values[5]=n;return}if(e instanceof DOMMatrix){this.values[0]=e.m11,this.values[1]=e.m12,this.values[2]=e.m21,this.values[3]=e.m22,this.values[4]=e.m41,this.values[5]=e.m42;return}if(e instanceof p){this.values=e.values;return}if(Array.isArray(e)){if(e.length===2){this.values[0]=e[0],this.values[1]=e[1],this.values[2]=t[0],this.values[3]=t[1],this.values[4]=i[0],this.values[5]=i[1];return}if(e.length===3){const d=new u(e[0]),v=new u(e[1]),g=new u(e[2]);this.values[0]=d.x,this.values[1]=d.y,this.values[2]=v.x,this.values[3]=v.y,this.values[4]=g.x,this.values[5]=g.y;return}this.values[0]=e[0],this.values[1]=e[1],this.values[2]=e[2],this.values[3]=e[3],this.values[4]=e[4],this.values[5]=e[5];return}const h=new u(e),c=new u(t),o=new u(i);this.values[0]=h.x,this.values[1]=h.y,this.values[2]=c.x,this.values[3]=c.y,this.values[4]=o.x,this.values[5]=o.y}column(e){return new u(this.values[e*2],this.values[e*2+1])}row(e){return[this.values[e],this.values[e+2],this.values[e+4]]}mul(e){const t=this.values[0],i=this.values[1],r=this.values[2],a=this.values[3],n=this.values[4],h=this.values[5],c=e.values[0],o=e.values[1],d=e.values[2],v=e.values[3],g=e.values[4],k=e.values[5];return new p(t*c+r*o,i*c+a*o,t*d+r*v,i*d+a*v,t*g+r*k+n,i*g+a*k+h)}rotate(e,t=!0){t&&(e*=j);const i=this.values[0],r=this.values[1],a=this.values[2],n=this.values[3],h=this.values[4],c=this.values[5],o=Math.sin(e),d=Math.cos(e);return new p(i*d+a*o,r*d+n*o,i*-o+a*d,r*-o+n*d,h,c)}scale(e){const t=new u(e);return new p(this.values[0]*t.x,this.values[1]*t.x,this.values[2]*t.y,this.values[3]*t.y,this.values[4],this.values[5])}mulScalar(e){return new p(this.values[0]*e,this.values[1]*e,this.values[2]*e,this.values[3]*e,this.values[4]*e,this.values[5]*e)}translate(e){const t=new u(e);return new p(this.values[0],this.values[1],this.values[2],this.values[3],this.values[0]*t.x+this.values[2]*t.y+this.values[4],this.values[1]*t.x+this.values[3]*t.y+this.values[5])}add(e){return new p(this.values[0]+e.values[0],this.values[1]+e.values[1],this.values[2]+e.values[2],this.values[3]+e.values[3],this.values[4]+e.values[4],this.values[5]+e.values[5])}sub(e){return new p(this.values[0]-e.values[0],this.values[1]-e.values[1],this.values[2]-e.values[2],this.values[3]-e.values[3],this.values[4]-e.values[4],this.values[5]-e.values[5])}toSymbol(){return p.symbol}equals(e,t=we){return Math.abs(this.values[0]-e.values[0])<=t+Number.EPSILON&&Math.abs(this.values[1]-e.values[1])<=t+Number.EPSILON&&Math.abs(this.values[2]-e.values[2])<=t+Number.EPSILON&&Math.abs(this.values[3]-e.values[3])<=t+Number.EPSILON&&Math.abs(this.values[4]-e.values[4])<=t+Number.EPSILON&&Math.abs(this.values[5]-e.values[5])<=t+Number.EPSILON}exactlyEquals(e){return this.values[0]===e.values[0]&&this.values[1]===e.values[1]&&this.values[2]===e.values[2]&&this.values[3]===e.values[3]&&this.values[4]===e.values[4]&&this.values[5]===e.values[5]}}p.symbol=Symbol.for("@motion-canvas/core/types/Matrix2D");p.identity=new p(1,0,0,1,0,0);p.zero=new p(0,0,0,0,0,0);class u{static createSignal(e,t=u.lerp,i){return new pt(["x","y"],r=>new u(r),e,t,i).toSignal()}static lerp(e,t,i){let r,a;return typeof i=="number"?r=a=i:(r=i.x,a=i.y),new u(S(e.x,t.x,r),S(e.y,t.y,a))}static arcLerp(e,t,i,r=!1,a){return a??(a=e.sub(t).ctg),u.lerp(e,t,ot(i,r,a))}static createArcLerp(e,t){return(i,r,a)=>u.arcLerp(i,r,a,e,t)}static polarLerp(e,t,i,r=!1,a=u.zero){e=e.sub(a),t=t.sub(a);const n=e.degrees;let h=t.degrees;n>h!==r&&(h=h+(r?-360:360));const c=S(n,h,i)*j,o=S(e.magnitude,t.magnitude,i);return new u(o*Math.cos(c)+a.x,o*Math.sin(c)+a.y)}static createPolarLerp(e=!1,t=u.zero){return(i,r,a)=>u.polarLerp(i,r,a,e,new u(t))}static fromOrigin(e){const t=new u;return e===B.Middle||(e&I.Left?t.x=-1:e&I.Right&&(t.x=1),e&I.Top?t.y=-1:e&I.Bottom&&(t.y=1)),t}static fromScalar(e){return new u(e,e)}static fromRadians(e){return new u(Math.cos(e),Math.sin(e))}static fromDegrees(e){return u.fromRadians(e*j)}static radians(e,t){return Math.atan2(t,e)}static degrees(e,t){return u.radians(e,t)*st}static magnitude(e,t){return Math.sqrt(e*e+t*t)}static squaredMagnitude(e,t){return e*e+t*t}static angleBetween(e,t){return Math.acos(be(-1,1,e.dot(t)/(e.magnitude*t.magnitude)))*(e.cross(t)>=0?1:-1)}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}get magnitude(){return u.magnitude(this.x,this.y)}get squaredMagnitude(){return u.squaredMagnitude(this.x,this.y)}get normalized(){return this.scale(1/u.magnitude(this.x,this.y))}get safe(){return new u(isNaN(this.x)?0:this.x,isNaN(this.y)?0:this.y)}get flipped(){return new u(-this.x,-this.y)}get floored(){return new u(Math.floor(this.x),Math.floor(this.y))}get perpendicular(){return new u(this.y,-this.x)}get radians(){return u.radians(this.x,this.y)}get degrees(){return u.degrees(this.x,this.y)}get ctg(){return this.x/this.y}constructor(e,t){if(this.x=0,this.y=0,e!=null){if(typeof e!="object"){this.x=e,this.y=t??e;return}if(Array.isArray(e)){this.x=e[0],this.y=e[1];return}if("width"in e){this.x=e.width,this.y=e.height;return}this.x=e.x,this.y=e.y}}lerp(e,t){return u.lerp(this,e,t)}getOriginOffset(e){const t=u.fromOrigin(e);return t.x*=this.x/2,t.y*=this.y/2,t}scale(e){return new u(this.x*e,this.y*e)}transformAsPoint(e){const t=new p(e);return new u(this.x*t.scaleX+this.y*t.skewY+t.translateX,this.x*t.skewX+this.y*t.scaleY+t.translateY)}transform(e){const t=new p(e);return new u(this.x*t.scaleX+this.y*t.skewY,this.x*t.skewX+this.y*t.scaleY)}mul(e){const t=new u(e);return new u(this.x*t.x,this.y*t.y)}div(e){const t=new u(e);return new u(this.x/t.x,this.y/t.y)}add(e){const t=new u(e);return new u(this.x+t.x,this.y+t.y)}sub(e){const t=new u(e);return new u(this.x-t.x,this.y-t.y)}dot(e){const t=new u(e);return this.x*t.x+this.y*t.y}cross(e){const t=new u(e);return this.x*t.y-this.y*t.x}mod(e){const t=new u(e);return new u(this.x%t.x,this.y%t.y)}rotate(e,t=u.zero){const i=new u(t),r=p.fromTranslation(i).rotate(e).translate(i.flipped);return this.transformAsPoint(r)}addX(e){return new u(this.x+e,this.y)}addY(e){return new u(this.x,this.y+e)}toSymbol(){return u.symbol}toString(){return`Vector2(${this.x}, ${this.y})`}serialize(){return{x:this.x,y:this.y}}exactlyEquals(e){return this.x===e.x&&this.y===e.y}equals(e,t=we){return Math.abs(this.x-e.x)<=t+Number.EPSILON&&Math.abs(this.y-e.y)<=t+Number.EPSILON}}u.symbol=Symbol.for("@motion-canvas/core/types/Vector2");u.zero=new u;u.one=new u(1,1);u.right=new u(1,0);u.left=new u(-1,0);u.up=new u(0,1);u.down=new u(0,-1);const yt=`<style>${Ue}</style>${Ke}`,ce="motion-canvas-player";class gt extends HTMLElement{constructor(){super(),y(this,"root"),y(this,"canvas"),y(this,"overlay"),y(this,"button"),y(this,"state","initial"),y(this,"project",null),y(this,"player",null),y(this,"defaultSettings"),y(this,"abortController",null),y(this,"mouseMoveId",null),y(this,"finished",!1),y(this,"playing",!1),y(this,"connected",!1),y(this,"stage",new He),y(this,"handleMouseMove",()=>{this.mouseMoveId&&clearTimeout(this.mouseMoveId),this.hover&&!this.playing&&this.setPlaying(!0),this.mouseMoveId=window.setTimeout(()=>{this.mouseMoveId=null,this.updateClass()},2e3),this.updateClass()}),y(this,"handleMouseLeave",()=>{this.hover&&this.setPlaying(!1),this.mouseMoveId&&(clearTimeout(this.mouseMoveId),this.mouseMoveId=null,this.updateClass())}),y(this,"handleMouseDown",e=>{e.preventDefault()}),y(this,"handleClick",()=>{this.auto||(this.handleMouseMove(),this.setPlaying(!this.playing),this.button.animate([{scale:"0.9"},{scale:"1",easing:"ease-out"}],{duration:200}))}),y(this,"render",async()=>{this.player&&await this.stage.render(this.player.playback.currentScene,this.player.playback.previousScene)}),this.root=this.attachShadow({mode:"open"}),this.root.innerHTML=yt,this.overlay=this.root.querySelector(".overlay"),this.button=this.root.querySelector(".button"),this.canvas=this.stage.finalBuffer,this.canvas.classList.add("canvas"),this.root.prepend(this.canvas),this.overlay.addEventListener("click",this.handleClick),this.overlay.addEventListener("mousemove",this.handleMouseMove),this.overlay.addEventListener("mouseleave",this.handleMouseLeave),this.button.addEventListener("mousedown",this.handleMouseDown),this.setState("initial")}static get observedAttributes(){return["src","quality","width","height","auto","variables"]}get auto(){return!!this.getAttribute("auto")}get hover(){return this.getAttribute("auto")==="hover"}get quality(){const e=this.getAttribute("quality");return e?parseFloat(e):this.defaultSettings.resolutionScale}get width(){const e=this.getAttribute("width");return e?parseFloat(e):this.defaultSettings.size.width}get height(){const e=this.getAttribute("height");return e?parseFloat(e):this.defaultSettings.size.height}get variables(){try{const e=this.getAttribute("variables");return e?JSON.parse(e):{}}catch{return this.project.logger.warn("Project variables could not be parsed."),{}}}setState(e){this.state=e,this.setPlaying(this.playing)}setPlaying(e){var t,i;this.state==="ready"&&(e||this.auto&&!this.hover)?((t=this.player)==null||t.togglePlayback(!0),this.playing=!0):((i=this.player)==null||i.togglePlayback(!1),this.playing=!1),this.updateClass()}updateClass(){this.overlay.className=`overlay state-${this.state}`,this.canvas.className=`canvas state-${this.state}`,this.overlay.classList.toggle("playing",this.playing),this.overlay.classList.toggle("auto",this.auto),this.overlay.classList.toggle("hover",this.mouseMoveId!==null),this.connected&&(this.mouseMoveId!==null||!this.playing?this.dataset.overlay="":delete this.dataset.overlay)}async updateSource(e){var t,i,r,a;this.setState("initial"),(t=this.abortController)==null||t.abort(),this.abortController=new AbortController;let n;try{const c=$e(()=>import(e),[]),o=new Promise(d=>setTimeout(d,200));await Promise.any([o,c]),this.setState("loading"),n=(await c).default}catch(c){console.error(c),this.setState("error");return}this.defaultSettings=n.meta.getFullRenderingSettings();const h=new Xe(n);h.setVariables(this.variables),this.finished=!1,(i=this.player)==null||i.onRender.unsubscribe(this.render),(r=this.player)==null||r.togglePlayback(!1),(a=this.player)==null||a.deactivate(),this.project=n,this.player=h,this.updateSettings(),this.player.onRender.subscribe(this.render),this.player.togglePlayback(this.playing),this.setState("ready")}attributeChangedCallback(e,t,i){var r;switch(e){case"auto":this.setPlaying(this.playing);break;case"src":this.updateSource(i);break;case"quality":case"width":case"height":this.updateSettings();break;case"variables":(r=this.player)==null||r.setVariables(this.variables)}}disconnectedCallback(){var e,t;this.connected=!1,(e=this.player)==null||e.deactivate(),(t=this.player)==null||t.onRender.unsubscribe(this.render)}connectedCallback(){var e,t;this.connected=!0,(e=this.player)==null||e.activate(),(t=this.player)==null||t.onRender.subscribe(this.render)}updateSettings(){const e={...this.defaultSettings,size:new u(this.width,this.height),resolutionScale:this.quality};this.stage.configure(e),this.player.configure(e)}}customElements.get(ce)||customElements.define(ce,gt);export{fe as A,Et as B,Be as C,b as D,Se as E,Tt as F,Pt as G,Mt as H,D as I,Ne as J,f as M,N as O,R as P,se as S,T as V,V as a,Re as b,bt as c,H as d,xt as e,St as f,kt as g,mt as h,F as i,Pe as j,_ as k,l,w as m,ze as n,Ie as o,pe as p,W as q,De as r,wt as s,G as t,Z as u,je as v,qe as w,Te as x,C as y,ve as z};
